<div class="container col-md-12" id="interactions-lookup">
  <%= search_form_for @q, url:advanced_search_interactions_path do |f| %>
    <div class="container col-md-12">
      <%= render 'interactions/advanced_search/compounds/molecules', f:f %>
      <%= render 'interactions/advanced_search/compounds/hosts', f:f %>
      <%= render 'interactions/advanced_search/compounds/supplements', f:f %>
      <%= render 'interactions/advanced_search/more_options', f:f %>
      <%= render 'interactions/advanced_search/buttons', f:f %>
    </div>
  <% end %>
  <div class="row">
    <div class="col-md-12" id="advanced_search_content"></div>
  </div>
  <div class="row">
    <div class="col-md-3 center">
      <%= image_tag "preloader/default_trans.png", size:"50x50", class:"formLoader"%>
    </div>
      
      <div class="col-md-9" id="advanced_search_paginator"></div>
  </div>
</div>

<script type="text/javascript">
  var dataTablesProp = {
      retrieve: true,
      "bAutoWidth": false,
      stateSave: true,
      paging: false,
      ordering: false,
      searching: false,
      info: false,
      "pageLength": 10,
      "order": [],
      "columnDefs": [{
        "targets"  : 'no-sort',
        "orderable": false,
        },
        {"targets"    : [ 1,2,5,6 ],
         "visible"    : false},
         {"width": "2%", "targets": [9]},
        {"width": "3%", "targets": [1,3,5,7]}],
      "drawCallback": function(){
  
          $('[data-toggle="ajax-popover"]').popover({
            container: 'body',
            placement : 'top',
              trigger : 'click',
              html : true,
          });
          $('[data-toggle="ajax-tooltip"]').tooltip({
              placement : 'right',
              trigger : 'hover',
              html : true,
          });
          $('[data-toggle="tooltip"]').tooltip({
              placement : 'left',
              trigger : 'hover',
              html : true,
          });
          $('[data-toggle="left-tooltip"]').tooltip({
              placement : 'left',
              trigger : 'hover',
              html : true,
          });
  
        }
      }
  
    var dataTables = {
      "molecules":NaN
    }
  
  
  
  
    $(document).on('ready turbolinks:load', function(){
    var $loading = $('.formLoader').hide();
    $(document)
      .ajaxStart(function () {
        $loading.show();
      })
      .ajaxComplete(function () {
        $loading.hide();
        dataTables.molecules = $('#int-index-molecules').DataTable(dataTablesProp);
        $('.kaminari-paginate-button').on("click", function (){
          hidePopovers();
        });
      });
     });
  
  $(document).on('ready turbolinks:load', function(){
    //$("#content").html("Gguten Tag")
    $("#advanced_search_content").html("<%= escape_javascript(render 'interactions/advanced_search/ransack_table', interactions:@interactions, table_id:"molecules") %>")
    <% if @interactions.present? %>
  
      $('#advanced_search_paginator').html('<%= escape_javascript(paginate(@interactions, btncolor:"primary", :remote => true).to_s) %>');
      $('#advanced_search_paginator').show();
    <% end %>
    dataTables.molecules = $('#int-index-molecules').DataTable(dataTablesProp);
    $('.kaminari-paginate-button').on("click", function (){
      hidePopovers();
    });
    molecule_fields = ['#q_molecule_display_name_eq', '#q_host_display_name_eq', '#q_indicator_display_name_or_conjugate_display_name_eq', '#q_solvents_display_name_eq']
    list_fields = ['#q_assay_type_eq', '#q_technique_eq']
    list_fields.forEach(function(element) {
      var input = $(element).autocomplete({
      source: $(element).data('autocomplete-source'),
      select: function( event, ui ) {
        $( element ).val( ui.item[0] );
        return false;
      }
        });
      var autoComplete = input.autocomplete( "instance" );
      if (autoComplete) {
        autoComplete._renderItem = function( ul, item ) {
          ul.addClass('adv_technique');
        return $( "<li class='col-md-12'>" )
          .append( "<div class='well col-md-12 center' >" + item[0] + " | <span class='icon-" + item[1].toLowerCase() + " " + item[1] + "'></span></div>" )
          .appendTo( ul );
        }
      }
        
    });
    molecule_fields.forEach(function(element) {
      var input = $(element).autocomplete({
      source: $(element).data('autocomplete-source'),
      select: function( event, ui ) {
        $( element ).val( ui.item[1] );
        return false;
      }});
      var autoComplete = input.autocomplete( "instance" );
      if (autoComplete) {
        autoComplete._renderItem = function( ul, item ) {
        return $( "<li class='col-md-4'>" )
          .append( "<div class='well col-md-12 center' >" + item[0].substring(0, 20) + " <br> "  + "<div class='center'>" + " <br>  " + "<img src=" + item[2] + " alt='image' height='150'>" + "</div>"+ item[1].substring(0, 20)  +  " <span>"   + "</span></div>" )
          .appendTo( ul );
        };
      };
    });
  });
  
  
  $(document).on('ready turbolinks:load', function() {
    $("#reset_refinement").click(function() {
      $('.refinement-input').val("")
    });
    $('.fas.fa-trash').click(function() {
      $(this).parents('.row').first().find('input').val("")
    });
  var explainPopupShown = localStorage.getItem('explainPopupShown');
  
  if (explainPopupShown === null) {
  $('#explainPopup').popover({
      container: 'body',
      placement : 'top',
      trigger : 'click',
      html : true,
  }).popover('show');
  localStorage.setItem('explainPopupShown', 1);
  } else {
  $('#explainPopup').popover({
      container: 'body',
      placement : 'top',
      trigger : 'click',
      html : true,
  });
  };
  
  
  });
  
  $(document).on('ready turbolinks:load', function() {
  $('label[for=q_buffer_name_eq] .fas.fa-trash').click(function() {
    $( "#loaded-buffer" ).empty()
  })
   $('#q_buffer_name_eq').autocomplete({
   source: $('#q_buffer_name_eq').data('autocomplete-source'),
   select: function( event, ui ) {
     $( "#q_buffer_name_eq" ).val( ui.item[0] );
     $( "#loaded-buffer" ).html("<div class='col-md-12'>" + ui.item[0] + "<hr> </div>");
     $( "#loaded-buffer" ).append("<div class='col-md-3'> pH = <b> " + ui.item[2] + "</b> </div> <div class='col-md-3'> c<sub>total</sub> = <b> " + ui.item[3] + " </b> mM </div> <div class='col-md-6'> <b>  Modified: <b>" + ui.item[4] + "</b> </div>");
     $( "#loaded-buffer" ).append("<div class='col-md-12'> <br> </div>");
     $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'><b> solvent </b> </div> <div class='col-md-3'><b> vol% </b> <br> </div>");
     $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[5] + "</div>");
     if (ui.item[6] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[6] + "<br> </div>");
     } else {
       $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
     };
     if (ui.item[9] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[9] + "</div>");
       if (ui.item[10] != "not given") {
         $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[10] + "<br></div>");
       } else {
         $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
       };
     };
     if (ui.item[13] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[13] + " </div>");
       if (ui.item[14] != "not given") {
         $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[14] + "<br> </div>");
       } else {
         $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
       };
     };
     $( "#loaded-buffer" ).append("<div class='col-md-12'> <br> </div>");
     $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'><b> additive </b> </div> <div class='col-md-3'><b> mM </b> <br> </div>");
     if (ui.item[7] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[7] + " </div>");
       if (ui.item[8] != "not given") {
         $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[8] + "<br>  </div>");
       } else {
         $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
       };
     };
     if (ui.item[11] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[11] + "</div>");
       if (ui.item[12] != "not given") {
         $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[12] + "<br> </div>");
       } else {
         $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
       };
     };
     if (ui.item[15] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[15] + " </div>");
       if (ui.item[16] != "not given") {
         $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[16] + "<br> </div>");
       } else {
         $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
       };
     };
     if (ui.item[17] != "not given") {
       $( "#loaded-buffer" ).append("<div class='col-md-9 solvent-container'>"+ ui.item[17] + " </div>");
       if (ui.item[18] != "not given") {
         $( "#loaded-buffer" ).append("<div class='col-md-3'>"+ ui.item[18] + "<br> </div>");
       } else {
         $( "#loaded-buffer" ).append("<div class='col-md-3'><br></div>");
       };
     };

         //  if (ui.item[17] != "not given") {
   //    $( "#loaded-buffer" ).append("<div class='col-md-12'>Source of additives concentration: <b>"+ ui.item[17] + "</b>" + "</div>");
  //   };
     return false;
   },
   response: function(event, ui) {
           // ui.content is the array that's about to be sent to the response callback.
           if (ui.content.length === 0) {
               $("#empty-message-buffer").html("<%= escape_javascript(render 'interactions/autocomplete/response_buffers', molecule:"Buffer") %>");
           } else {
               $("#empty-message-buffer").empty();
           }
   }
     })
     .autocomplete( "instance" )._renderItem = function( ul, item ) {
     return $( "<li class='col-md-12'>" )
       .append( "<div class='col-md-12'> <b>" + item[0].substring(0, 20) + "</b>; pH = <b>" + item[2] + "</b>; c <sub>Total</sub> = <b> " + item[3] + " </b> mM; Modified: <b>" + item[4] + "</b> <span>"   + "</span></div>" )
       .appendTo( ul );
     };
   });
  
 
</script>
