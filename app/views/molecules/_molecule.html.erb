<div class="table-responsive">
  <table class="table col-md-12" id="mol-index">
    <thead>
      <tr>
        <th colspan="1" class="col-md-1 no-sort"> Info  </th>
        <th class="no-sort" style="text-align: right;">
          <button class="btn btn-sm btn-primary has-tooltip" type="button" data-toggle="tooltip" title="Show structures" onclick="viewStructure()">
            <%= image_tag "struc.svg", size:"17x17" %>
          </button></th>
        <th class="col-md-2"><span>Name</span></th>
        <th class="no-sort" style="text-align: right;">
          <button class="btn btn-sm btn-primary has-tooltip" type="button" data-toggle="tooltip" title="Show names" onclick="viewNames()">
            <i class="fa fa-list" aria-hidden="true"></i>
          </button></th>
        <th class="col-md-2 " ><span>Structure</span>
          <th class="col-md-1">M / g/mol</th>
          <th class="col-md-1">Interactions</th>
          <th class="col-md-1 no-sort">Identifier</th>
          <th class="col-md-1">Updated</th>
        </tr>
      </thead>
      <% @molecules.each do |entry| %>
        <tr>
          <td class="col-md-1">
            <span class="has-tooltip" data-toggle="ajax-tooltip" title="<%= "Show  #{entry.display_name}" %>">
              <%= link_to "", {controller: "molecules", action: 'show', id: entry.id}, class:'far fa-eye'%>
            </span>
            <span> | </span>
            <span class="has-js-popover info_popover" data-toggle="ajax-popover" data-container="body" data-toggle="ajax-popover" title= "<span class='text-info'><strong>IDs</strong></span>
            <button type='button' id='close' class='close' onclick='$(&quot;.info_popover&quot;).popover(&quot;hide&quot;);' > &times;</button>"
            style=""
            data-content=' 
            <div class="left"> 
              <p>PubChem: CID = <%= entry.cid %></p>
               
              <p>SupraBank: SBID = <%= entry.id %></p>
               </div>
            ' >
            <i class="fa fa-info-circle"></i>
          </span>
          <% if policy(entry).update? %>
            <span> | </span>
            <span class="has-tooltip" data-toggle="ajax-tooltip" title="<%= "Edit  #{entry.display_name}" %>">
              <%= link_to "", {controller: "molecules", action: 'edit', id: entry.id}, class:'fa fa-pencil'%>
            </span>
            <span class="has-tooltip" data-toggle="ajax-tooltip" title="<%= "Delete  #{entry.display_name}" %>">
              <%#= link_to "", molecule_path(entry), method: :delete, data: {confirm: 'Are you sure?'}, class:'fa fa-trash'%>
            </span>
          <% end %>
        </td>
        <td class="" >
        </td>
        <td class="col-md-2">
          <span class="has-tooltip" data-toggle="ajax-tooltip" title="<%= truncate(entry.display_name, length: 30) %>">
            <span class="has-js-popover structure_popover_molecule" data-toggle="ajax-popover" data-container="body" title= "<span class='text-info'><strong>Structure</strong></span>
            <button type='button' id='close' class='close' onclick='$(&quot;.structure_popover_molecule&quot;).popover(&quot;hide&quot;);' > &times;</button>" id="structure_popover_molecule"
            style=""
            data-content='
            <div class="center structure-image-panel">
              <input type="checkbox" id="zoomCheck" class="zoomCheck">
              <label for="zoomCheck">
                <%= image_tag entry.png_url, class:"popover_molecule_image"%>
              </label>
              <p><%= link_to "Show all Information", molecule_path(entry) %></p>
            </div>
            ' >
            <%= entry.preferred_abbreviation.present? ? entry.preferred_abbreviation : truncate(entry.display_name, length: 20)%>
          </span>
        </span>
      </td>
      <td class="">
      </td>
      <td class="col-md-2 img-td" style="height: 160px">
        <span style="display: none"> <%= entry.preferred_abbreviation.present? ? entry.preferred_abbreviation : truncate(entry.display_name, length: 20)%> </span>
        <span class="has-tooltip" data-toggle="ajax-tooltip" title="<%= truncate(entry.display_name, length: 30) %>">
          <%= image_tag entry.png_url, class: 'interaction-structure-image'%>
        </span>
      </td>
      <td class="col-md-1">
        <span class="has-tooltip" data-toggle="ajax-tooltip" title="<%= "M =  #{entry.molecular_weight} g/mol" %>">
          <%= "%.2f" % entry.molecular_weight.to_f %>
        </span>
      </td>
      <td class="col-md-1">
        <%= link_to entry.interactions_count, interactions_molecule_path(entry), class:'badge dataset_size'%>
      </td>
      <td class="col-md-2">
        <span class="has-js-popover pubchem_popover" data-toggle="ajax-popover" data-container="body" data-toggle="ajax-popover" title= "<span class='text-info'><strong>PubChem</strong></span>
        <button type='button' id='close' class='close' onclick='$(&quot;.pubchem_popover&quot;).popover(&quot;hide&quot;);' > &times;</button>"
        style=""
        data-content='
        <div class="center">
          <p>CID = <%= entry.cid %></p>
        </div>
        ' >
        PubChem
      </span>
      <span> | </span>
      <span class="has-js-popover inchi_popover" data-toggle="ajax-popover" data-container="body" data-toggle="ajax-popover" title= "<span class='text-info'><strong>InChI</strong></span>
      <button type='button' id='close' class='close' onclick='$(&quot;.inchi_popover&quot;).popover(&quot;hide&quot;);' > &times;</button>"
      style=""
      data-content='
      <div class="inside-js-popover">
        <p><%= entry.inchistring %></p>
        <strong>InChI key:</strong>
        <p><%= entry.inchikey %></p>
      </div>
      ' >
      InChI
    </span>
    <span> | </span>
    <span class="has-js-popover smiles_popover" data-toggle="ajax-popover" data-container="body"data-toggle="ajax-popover" title= "<span class='text-info'><strong>SMILES</strong></span>
    <button type='button' id='close' class='close' onclick='$(&quot;.smiles_popover&quot;).popover(&quot;hide&quot;);' > &times;</button>"
    style=""
    data-content='
    <div class="inside-js-popover">
      <strong>Canonical SMILES</strong>
      <p><%= entry.cano_smiles %></p>
      <strong>Isomeric SMILES</strong>
      <p><%= entry.iso_smiles %></p>
    </div>
    ' >
    Smiles
  </span>
</td>
<td class="col-md-1">
  <span style="display:none;">"<%= entry.updated_at.strftime("%Y%m%d%H%M%s") %>"</span>
  <span class="has-tooltip" data-toggle="tooltip" title="<%= "created at  #{entry.created_at.strftime("%d %b %Y")} " %>">
    <%= entry.updated_at.strftime("%d %b %Y") %>
  </span></td>
</tr>
<% end %>
</table>
</div>
<script type="text/javascript">
  dataTable = $('#mol-index').DataTable({
    "bAutoWidth": false,
    stateSave: true,
    "order": [[5, "desc" ]],
    "columnDefs": [{
      "targets"    : 'no-sort',
      "orderable"  : false },
     {"targets"    : [ 3,4 ],
      "visible"    : false},
      {"width": "3%", "targets": [1,3]}
     ],
  
    "drawCallback": function(){
  
        $('[data-toggle="ajax-popover"]').popover({
            container: 'body',
            placement : 'bottom',
            trigger : 'click',
            html : true,
        });
        $('[data-toggle="ajax-tooltip"]').tooltip({
            placement : 'right',
            trigger : 'hover',
            html : true,
        });
        $('[data-toggle="tooltip"]').tooltip({
            placement : 'left',
            trigger : 'hover',
            html : true,
        });
    }
  
  });
  
  if ($('button[name=searchMoleculeButton]').hasClass('.clicked')) {
    $('button[name=searchMoleculeButton]').removeClass('.clicked');
    dataTable.state.clear().destroy();
    dataTable = $('#mol-index').DataTable({
      "bAutoWidth": false,
      stateSave: true,
      "order": [[5, "desc" ]],
      "columnDefs": [{
        "targets"    : 'no-sort',
        "orderable"  : false },
       {"targets"    : [ 3,4 ],
        "visible"    : false},
        {"width": "3%", "targets": [1,3]}
       ],
  
      "drawCallback": function(){
  
          $('[data-toggle="ajax-popover"]').popover({
              container: 'body',
              placement : 'bottom',
              trigger : 'click',
              html : true,
          });
          $('[data-toggle="ajax-tooltip"]').tooltip({
              placement : 'right',
              trigger : 'hover',
              html : true,
          });
          $('[data-toggle="tooltip"]').tooltip({
              placement : 'left',
              trigger : 'hover',
              html : true,
          });
      }
  
    });
  };
  
  dataTable.on('page.dt', function(){
      $('[data-toggle="ajax-popover"]').popover('hide');
    });
  
    dataTable.on('order.dt', function(){
        $('[data-toggle="ajax-popover"]').popover('hide');
      });
  
  function viewStructure() {
    $('[data-toggle="ajax-popover"]').popover('hide');
    dataTable.columns(1).visible(false);
    dataTable.columns(2).visible(false);
    dataTable.columns(3).visible(true);
    dataTable.columns(4).visible(true);
    dataTable.draw(false);
  };
  
  function viewNames() {
    $('[data-toggle="ajax-popover"]').popover('hide');
    dataTable.columns(1).visible(true);
    dataTable.columns(2).visible(true);
    dataTable.columns(3).visible(false);
    dataTable.columns(4).visible(false);
    dataTable.draw(false);
  }
</script>
